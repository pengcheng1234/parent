<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jd.m.cms.bjshare.dao.ActivityDataStatisticalDao" >
  <resultMap id="BaseResultMap" type="com.jd.m.cms.bjshare.domain.po.ActivityDataStatistical" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="modifier" property="modifier" jdbcType="VARCHAR" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="is_delete" property="isDelete" jdbcType="INTEGER" />
    <result column="bizid" property="bizid" jdbcType="VARCHAR" />
    <result column="biz_type" property="bizType" jdbcType="INTEGER" />
    <result column="page_uv" property="pageUv" jdbcType="BIGINT" />
    <result column="activity_id" property="activityId" jdbcType="BIGINT" />
    <result column="vender_id" property="venderId" jdbcType="BIGINT" />
    <result column="statistical_time" property="statisticalTime" jdbcType="TIMESTAMP" />
    <result column="statistical_date" property="statisticalDate" jdbcType="BIGINT" />
    <result column="activity_name" property="activityName" jdbcType="VARCHAR" />
    <result column="click_number" property="clickNumber" jdbcType="BIGINT" />
    <result column="click_success_uv" property="clickSuccessUv" jdbcType="BIGINT" />
    <result column="open_number" property="openNumber" jdbcType="BIGINT" />
    <result column="open_success_uv" property="openSuccessUv" jdbcType="BIGINT" />
    <result column="order_number" property="orderNumber" jdbcType="BIGINT" />
    <result column="order_amount" property="orderAmount" jdbcType="DECIMAL" />
    <result column="drainage_avg_num" property="drainageAvgNum" jdbcType="BIGINT" />
    <result column="import_dau" property="importDau" jdbcType="BIGINT" />
    <result column="coupon_used_amount" property="couponUsedAmount" jdbcType="BIGINT" />
    <result column="bean_used_amount" property="beanUsedAmount" jdbcType="BIGINT" />
    <result column="coupon_cost_amount" property="couponCostAmount" jdbcType="BIGINT" />
    <result column="bean_cost_amount" property="beanCostAmount" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, creator, create_date, modifier, modify_time, is_delete, bizid, biz_type, page_uv, 
    activity_id, vender_id, statistical_time, statistical_date, activity_name,
    click_number, click_success_uv, open_number, open_success_uv, order_number, order_amount, 
    drainage_avg_num, import_dau, coupon_used_amount, bean_used_amount, coupon_cost_amount, 
    bean_cost_amount
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from activity_data_statistical
    where id = #{id,jdbcType=INTEGER}
  </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from activity_data_statistical
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insertSelective" parameterType="com.jd.m.cms.bjshare.domain.po.ActivityDataStatistical" >
    insert into activity_data_statistical
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="modifyTime != null" >
        modify_time,
      </if>
      <if test="isDelete != null" >
        is_delete,
      </if>
      <if test="bizid != null" >
        bizid,
      </if>
      <if test="bizType != null" >
        biz_type,
      </if>
      <if test="pageUv != null" >
        page_uv,
      </if>
      <if test="activityId != null" >
        activity_id,
      </if>
      <if test="venderId != null" >
        vender_id,
      </if>
      <if test="statisticalTime != null" >
        statistical_time,
      </if>
      <if test="statisticalDate != null" >
        statistical_date,
      </if>
      <if test="activityName != null" >
        activity_name,
      </if>
      <if test="clickNumber != null" >
        click_number,
      </if>
      <if test="clickSuccessUv != null" >
        click_success_uv,
      </if>
      <if test="openNumber != null" >
        open_number,
      </if>
      <if test="openSuccessUv != null" >
        open_success_uv,
      </if>
      <if test="orderNumber != null" >
        order_number,
      </if>
      <if test="orderAmount != null" >
        order_amount,
      </if>
      <if test="drainageAvgNum != null" >
        drainage_avg_num,
      </if>
      <if test="importDau != null" >
        import_dau,
      </if>
      <if test="couponUsedAmount != null" >
        coupon_used_amount,
      </if>
      <if test="beanUsedAmount != null" >
        bean_used_amount,
      </if>
      <if test="couponCostAmount != null" >
        coupon_cost_amount,
      </if>
      <if test="beanCostAmount != null" >
        bean_cost_amount,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null" >
        #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="bizid != null" >
        #{bizid,jdbcType=VARCHAR},
      </if>
      <if test="bizType != null" >
        #{bizType,jdbcType=INTEGER},
      </if>
      <if test="pageUv != null" >
        #{pageUv,jdbcType=BIGINT},
      </if>
      <if test="activityId != null" >
        #{activityId,jdbcType=BIGINT},
      </if>
      <if test="venderId != null" >
        #{venderId,jdbcType=BIGINT},
      </if>
      <if test="statisticalTime != null" >
        #{statisticalTime,jdbcType=TIMESTAMP},
      </if>
      <if test="statisticalDate != null" >
        #{statisticalDate,jdbcType=BIGINT},
      </if>
      <if test="activityName != null" >
        #{activityName,jdbcType=VARCHAR},
      </if>
      <if test="clickNumber != null" >
        #{clickNumber,jdbcType=BIGINT},
      </if>
      <if test="clickSuccessUv != null" >
        #{clickSuccessUv,jdbcType=BIGINT},
      </if>
      <if test="openNumber != null" >
        #{openNumber,jdbcType=BIGINT},
      </if>
      <if test="openSuccessUv != null" >
        #{openSuccessUv,jdbcType=BIGINT},
      </if>
      <if test="orderNumber != null" >
        #{orderNumber,jdbcType=BIGINT},
      </if>
      <if test="orderAmount != null" >
        #{orderAmount,jdbcType=DECIMAL},
      </if>
      <if test="drainageAvgNum != null" >
        #{drainageAvgNum,jdbcType=BIGINT},
      </if>
      <if test="importDau != null" >
        #{importDau,jdbcType=BIGINT},
      </if>
      <if test="couponUsedAmount != null" >
        #{couponUsedAmount,jdbcType=BIGINT},
      </if>
      <if test="beanUsedAmount != null" >
        #{beanUsedAmount,jdbcType=BIGINT},
      </if>
      <if test="couponCostAmount != null" >
        #{couponCostAmount,jdbcType=BIGINT},
      </if>
      <if test="beanCostAmount != null" >
        #{beanCostAmount,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jd.m.cms.bjshare.domain.po.ActivityDataStatistical" >
    update activity_data_statistical
    <set >
      <if test="creator != null" >
        creator = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null" >
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null" >
        is_delete = #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="bizid != null" >
        bizid = #{bizid,jdbcType=VARCHAR},
      </if>
      <if test="bizType != null" >
        biz_type = #{bizType,jdbcType=INTEGER},
      </if>
      <if test="pageUv != null" >
        page_uv = #{pageUv,jdbcType=BIGINT},
      </if>
      <if test="activityId != null" >
        activity_id = #{activityId,jdbcType=BIGINT},
      </if>
      <if test="venderId != null" >
        vender_id = #{venderId,jdbcType=BIGINT},
      </if>
      <if test="statisticalTime != null" >
        statistical_time = #{statisticalTime,jdbcType=TIMESTAMP},
      </if>
      <if test="statisticalDate != null" >
        statistical_date = #{statisticalDate,jdbcType=BIGINT},
      </if>
      <if test="activityName != null" >
        activity_name = #{activityName,jdbcType=VARCHAR},
      </if>
      <if test="clickNumber != null" >
        click_number = #{clickNumber,jdbcType=BIGINT},
      </if>
      <if test="clickSuccessUv != null" >
        click_success_uv = #{clickSuccessUv,jdbcType=BIGINT},
      </if>
      <if test="openNumber != null" >
        open_number = #{openNumber,jdbcType=BIGINT},
      </if>
      <if test="openSuccessUv != null" >
        open_success_uv = #{openSuccessUv,jdbcType=BIGINT},
      </if>
      <if test="orderNumber != null" >
        order_number = #{orderNumber,jdbcType=BIGINT},
      </if>
      <if test="orderAmount != null" >
        order_amount = #{orderAmount,jdbcType=DECIMAL},
      </if>
      <if test="drainageAvgNum != null" >
        drainage_avg_num = #{drainageAvgNum,jdbcType=BIGINT},
      </if>
      <if test="importDau != null" >
        import_dau = #{importDau,jdbcType=BIGINT},
      </if>
      <if test="couponUsedAmount != null" >
        coupon_used_amount = #{couponUsedAmount,jdbcType=BIGINT},
      </if>
      <if test="beanUsedAmount != null" >
        bean_used_amount = #{beanUsedAmount,jdbcType=BIGINT},
      </if>
      <if test="couponCostAmount != null" >
        coupon_cost_amount = #{couponCostAmount,jdbcType=BIGINT},
      </if>
      <if test="beanCostAmount != null" >
        bean_cost_amount = #{beanCostAmount,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

    <!-- 按日期分组查数据看板列表 -->
    <select id="getDataListByDate" resultMap="BaseResultMap" parameterType="java.util.Map">
        select ads.statistical_time,SUM(ads.page_uv) page_uv,SUM(ads.click_number) click_number,
        SUM(ads.click_success_uv) click_success_uv,SUM(ads.open_number) open_number,SUM(ads.open_success_uv) open_success_uv,
        SUM(ads.import_dau) import_dau,avg(ads.drainage_avg_num) drainage_avg_num,SUM(ads.order_number) order_number,
        SUM(ads.order_amount) order_amount,SUM(ads.coupon_cost_amount) coupon_cost_amount,SUM(ads.bean_cost_amount) bean_cost_amount,
        SUM(ads.coupon_used_amount) coupon_used_amount,SUM(ads.bean_used_amount) bean_used_amount
        from activity_data_statistical ads
        left join share_activity sa on ads.activity_id = sa.id
        where 1=1 and ads.is_delete = 0
        <if test="venderId != null" >
            and ads.vender_id = #{venderId,jdbcType=BIGINT}
        </if>
        <if test="bizType != null" >
            and ads.biz_type = #{bizType,jdbcType=INTEGER}
        </if>
        <if test="activityId != null" >
            and ads.activity_id = #{activityId,jdbcType=BIGINT}
        </if>
        <if test="status != null" >
            and sa.status = #{status,jdbcType=INTEGER}
        </if>
        <if test="startDate != null and endDate != null" >
            and ads.statistical_date BETWEEN #{startDate,jdbcType=BIGINT} AND #{endDate,jdbcType=BIGINT}
        </if>
        group by ads.statistical_time
        order by ads.statistical_time desc
    </select>

    <resultMap id="statisticalResultMap" type="com.jd.m.cms.bjshare.domain.vo.ActivityDataStatisticalVo" extends="BaseResultMap">
        <result property="shopId" column="shop_id"/>
    </resultMap>
    <!-- 按活动id分组查数据看板列表 -->
    <select id="getDataListByActivityId" resultMap="statisticalResultMap" parameterType="java.util.Map">
        select sa.shop_id,sa.activity_name,ads.activity_id,ads.biz_type,SUM(ads.page_uv) page_uv,SUM(ads.click_number) click_number,SUM(ads.click_success_uv) click_success_uv,
        SUM(ads.open_number) open_number,SUM(ads.open_success_uv) open_success_uv,
        SUM(ads.import_dau) import_dau,avg(ads.drainage_avg_num) drainage_avg_num,SUM(ads.order_number) order_number,
        SUM(ads.order_amount) order_amount,SUM(ads.coupon_cost_amount) coupon_cost_amount,SUM(ads.bean_cost_amount) bean_cost_amount,
        SUM(ads.coupon_used_amount) coupon_used_amount,SUM(ads.bean_used_amount) bean_used_amount
        from activity_data_statistical ads
        left join share_activity sa on ads.activity_id = sa.id
        where 1=1 and ads.is_delete = 0
        <if test="venderId != null" >
            and ads.vender_id = #{venderId,jdbcType=BIGINT}
        </if>
        <if test="bizType != null" >
            and ads.biz_type = #{bizType,jdbcType=INTEGER}
        </if>
        <if test="activityId != null" >
            and ads.activity_id = #{activityId,jdbcType=BIGINT}
        </if>
        <if test="status != null" >
            and sa.status = #{status,jdbcType=INTEGER}
        </if>
        <if test="startDate != null and endDate != null" >
            and ads.statistical_date BETWEEN #{startDate,jdbcType=BIGINT} AND #{endDate,jdbcType=BIGINT}
        </if>
        group by ads.activity_id,sa.activity_name,ads.biz_type,sa.shop_id
        <if test="sortFiled != null and sortFiled == 1 and sortValue != null and sortValue == 1">
            ORDER BY click_success_uv ASC
        </if>
        <if test="sortFiled != null and sortFiled == 1 and sortValue != null and sortValue == 2">
            ORDER BY click_success_uv DESC
        </if>
        <if test="sortFiled != null and sortFiled == 2 and sortValue != null and sortValue == 1">
            ORDER BY open_success_uv ASC
        </if>
        <if test="sortFiled != null and sortFiled == 2 and sortValue != null and sortValue == 2">
            ORDER BY open_success_uv DESC
        </if>
        <if test="sortFiled != null and sortFiled == 3 and sortValue != null and sortValue == 1">
            ORDER BY order_number ASC
        </if>
        <if test="sortFiled != null and sortFiled == 3 and sortValue != null and sortValue == 2">
            ORDER BY order_number DESC
        </if>
        <if test="sortFiled != null and sortFiled == 4 and sortValue != null and sortValue == 1">
            ORDER BY order_amount ASC
        </if>
        <if test="sortFiled != null and sortFiled == 4 and sortValue != null and sortValue == 2">
            ORDER BY order_amount DESC
        </if>
    </select>

    <!-- 获取spu或shop级别的数据列表 -->
    <select id="getBizList" resultMap="BaseResultMap" parameterType="java.util.Map">
        select ads.bizid,ads.biz_type,SUM(ads.page_uv) page_uv,SUM(ads.click_number) click_number,SUM(ads.click_success_uv) click_success_uv,
        SUM(ads.open_number) open_number,SUM(ads.open_success_uv) open_success_uv,
        SUM(ads.import_dau) import_dau,avg(ads.drainage_avg_num) drainage_avg_num,SUM(ads.order_number) order_number,
        SUM(ads.order_amount) order_amount,SUM(ads.coupon_cost_amount) coupon_cost_amount,SUM(ads.bean_cost_amount) bean_cost_amount,
        SUM(ads.coupon_used_amount) coupon_used_amount,SUM(ads.bean_used_amount) bean_used_amount
        from activity_data_statistical ads
        where 1=1
        and ads.is_delete = 0
        <if test="venderId != null" >
            and ads.vender_id = #{venderId,jdbcType=BIGINT}
        </if>
        <if test="activityId != null" >
            and ads.activity_id = #{activityId,jdbcType=BIGINT}
        </if>
        <if test="queryDate != null" >
            and ads.statistical_date = #{queryDate,jdbcType=BIGINT}
        </if>
        <if test="bizid != null and bizid !='' " >
            and ads.bizid = #{bizid,jdbcType=VARCHAR}
        </if>
        group by ads.bizid,ads.biz_type
        <if test="sortFiled != null and sortFiled == 1 and sortValue != null and sortValue == 1">
            ORDER BY click_success_uv ASC
        </if>
        <if test="sortFiled != null and sortFiled == 1 and sortValue != null and sortValue == 2">
            ORDER BY click_success_uv DESC
        </if>
        <if test="sortFiled != null and sortFiled == 2 and sortValue != null and sortValue == 1">
            ORDER BY open_success_uv ASC
        </if>
        <if test="sortFiled != null and sortFiled == 2 and sortValue != null and sortValue == 2">
            ORDER BY open_success_uv DESC
        </if>
        <if test="sortFiled != null and sortFiled == 3 and sortValue != null and sortValue == 1">
            ORDER BY order_number ASC
        </if>
        <if test="sortFiled != null and sortFiled == 3 and sortValue != null and sortValue == 2">
            ORDER BY order_number DESC
        </if>
        <if test="sortFiled != null and sortFiled == 4 and sortValue != null and sortValue == 1">
            ORDER BY order_amount ASC
        </if>
        <if test="sortFiled != null and sortFiled == 4 and sortValue != null and sortValue == 2">
            ORDER BY order_amount DESC
        </if>
        <if test="sortFiled != null and sortFiled == 5 and sortValue != null and sortValue == 1">
            ORDER BY import_dau ASC
        </if>
        <if test="sortFiled != null and sortFiled == 5 and sortValue != null and sortValue == 2">
            ORDER BY import_dau DESC
        </if>
    </select>

</mapper>